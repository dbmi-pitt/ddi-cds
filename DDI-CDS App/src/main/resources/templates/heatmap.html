<table id="heatmap" class="" style="width:100%">
    <thead>

    <tr>
        <td class="dt-head-center font-weight-bold" colspan="5">GFR Function (ml/Min)</td>
    </tr>
    <tr>
        <td class="dt-head-center">Kidney failure</td>
        <td class="dt-head-center">Severely decreased</td>
        <td class="dt-head-center">Moderately to severely decreased</td>
        <td class="dt-head-center">Mildly to moderately decreased</td>
        <td class="dt-head-center">Normal to high</td>
    </tr>


    </thead>
</table>


<script>
    function refreshTable(serumCreatinineEGFR) {
        var data = [
            ["<15", "15-29", "30-44", "45-59", ">= 60"],
            ["darkred", "red", "orange", "yellow", "green"],
        ]
        var column;
        var table = $('#heatmap').DataTable({
            data: data,
            rowsGroup: [0],
            paging: false,
            "ordering": false,
            "searching": false,
            "bDestroy": true,
            "bInfo": false,
            responsive: true,

            "fnRowCallback": function (nRow, aData, iDisplayIndex, iDisplayIndexFull) {
                for (var i = 0; i < aData.length; i++) {
                    $("td:eq(" + i + ")", nRow).addClass("dt-center");
                    if (aData[i] == "green") {
                        $("td:eq(" + i + ")", nRow).addClass("cell-block");
                        $("td:eq(" + i + ")", nRow).addClass("green-block");
                        $("td:eq(" + i + ")", nRow).text("");
                        if (serumCreatinineEGFR >= 60) {
                            $("td:eq(" + i + ")", nRow).addClass("gfr-block");
                            column = i;
                        }
                    }
                    if (aData[i] == "yellow") {
                        $("td:eq(" + i + ")", nRow).addClass("cell-block");
                        $("td:eq(" + i + ")", nRow).addClass("yellow-block");
                        $("td:eq(" + i + ")", nRow).text("");
                        if (serumCreatinineEGFR !== "" && serumCreatinineEGFR <= 59 && serumCreatinineEGFR >= 45) {
                            $("td:eq(" + i + ")", nRow).addClass("gfr-block");
                            column = i;
                        }
                    }
                    if (aData[i] == "orange") {
                        $("td:eq(" + i + ")", nRow).addClass("cell-block");
                        $("td:eq(" + i + ")", nRow).addClass("orange-block");
                        $("td:eq(" + i + ")", nRow).text("");
                        if (serumCreatinineEGFR !== "" && serumCreatinineEGFR <= 44 && serumCreatinineEGFR >= 30) {
                            $("td:eq(" + i + ")", nRow).addClass("gfr-block");
                            column = i;
                        }
                    }
                    if (aData[i] == "red") {
                        $("td:eq(" + i + ")", nRow).addClass("cell-block");
                        $("td:eq(" + i + ")", nRow).addClass("red-block");
                        $("td:eq(" + i + ")", nRow).text("");
                        if (serumCreatinineEGFR !== "" && serumCreatinineEGFR <= 29 && serumCreatinineEGFR >= 15) {
                            $("td:eq(" + i + ")", nRow).addClass("gfr-block");
                            column = i;
                        }
                    }
                    if (aData[i] == "darkred") {
                        $("td:eq(" + i + ")", nRow).addClass("cell-block");
                        $("td:eq(" + i + ")", nRow).addClass("dark-red-block");
                        $("td:eq(" + i + ")", nRow).text("");
                        if (serumCreatinineEGFR !== "" && serumCreatinineEGFR < 15 && serumCreatinineEGFR >= 0) {
                            $("td:eq(" + i + ")", nRow).addClass("gfr-block");
                            column = i;
                        }
                    }
                }
            },
        });

        $($($(table.table().header())[0].children[1])[0].children).each(function () {
            $(this).removeClass("font-weight-bold").removeClass("mark");
        });


        table.rows().every(function () {
            if (column !== undefined) {
                $(table.column(column).header()).addClass('font-weight-bold').addClass('mark');
                $(table.cell(0, column).node()).addClass('font-weight-bold').addClass('mark');
            }
        });
    }

    $(document).ready(function () {
        let serumCreatinineEGFR = [[${serumCreatinineEGFR}]];
        refreshTable(serumCreatinineEGFR);
    });
</script>
